<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Li&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Li&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Li&#39;s blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Li&#39;s blog">
  
    <link rel="alternate" href="/atom.xml" title="Li&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Li&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-PY-PathOperations" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/06/PY-PathOperations/" class="article-date">
  <time datetime="2018-09-05T16:00:00.000Z" itemprop="datePublished">2018-09-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/06/PY-PathOperations/">PY-PathOperations</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###路径操作</p>
<ul>
<li>路径操作模块：</li>
<li><p>3.4版本以前os.path模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line">In [<span class="number">2</span>]: p = path.join(<span class="string">'/etc'</span>,<span class="string">'sysconfig'</span>,<span class="string">'network'</span>)<span class="comment">#将字符串连接成路径</span></span><br><span class="line">In [<span class="number">3</span>]: print(type(p),p)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; /<span class="title">etc</span>/<span class="title">sysconfig</span>/<span class="title">network</span>#字符串类</span></span><br><span class="line"><span class="class"><span class="title">In</span> [4]:</span> print(path.exists(p))<span class="comment">#判断路径是否存在</span></span><br><span class="line"><span class="keyword">True</span></span><br><span class="line">In [<span class="number">5</span>]: print(path.split(p))<span class="comment">#head，tail</span></span><br><span class="line">(<span class="string">'/etc/sysconfig'</span>, <span class="string">'network'</span>)</span><br><span class="line">In [<span class="number">7</span>]: print(path.abspath(<span class="string">'.'</span>))<span class="comment">#当前路径</span></span><br><span class="line">/home/python/project/Thunk</span><br><span class="line">In [<span class="number">8</span>]: p = path.join(<span class="string">'o:/'</span>,p,<span class="string">'test.txt'</span>)<span class="comment">#如果出现两个/根则后面生效</span></span><br><span class="line">In [<span class="number">9</span>]: p</span><br><span class="line">Out[<span class="number">9</span>]: <span class="string">'/etc/sysconfig/network/test.txt'</span></span><br><span class="line">In [<span class="number">10</span>]: print(path.dirname(p))<span class="comment">#显示路径名</span></span><br><span class="line">/etc/sysconfig/network</span><br><span class="line">In [<span class="number">11</span>]: print(path.basename(p))<span class="comment">#显示文件名</span></span><br><span class="line">test.txt</span><br><span class="line">In [<span class="number">12</span>]: print(path.splitdrive(p))<span class="comment">#驱动器</span></span><br><span class="line">(<span class="string">''</span>, <span class="string">'/etc/sysconfig/network/test.txt'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.4版本开始，建议使用pathlib模块，提供Path对象来操作。包括目录和文件</p>
</li>
<li><p>pathlib模块：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">13</span>]: <span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line">In [<span class="number">14</span>]: p = Path()<span class="comment">#当前目录</span></span><br><span class="line">In [<span class="number">15</span>]: p</span><br><span class="line">Out[<span class="number">15</span>]: PosixPath(<span class="string">'.'</span>)</span><br><span class="line">In [<span class="number">16</span>]: print(p)</span><br><span class="line">.</span><br><span class="line">In [<span class="number">17</span>]: p = Path(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c/d'</span>)<span class="comment">#当前目录下的a/b/c/d</span></span><br><span class="line">In [<span class="number">18</span>]: p</span><br><span class="line">Out[<span class="number">18</span>]: PosixPath(<span class="string">'a/b/c/d'</span>)</span><br><span class="line">In [<span class="number">19</span>]: p = Path(<span class="string">'/etc'</span>)<span class="comment">#根下的etc目录</span></span><br><span class="line">In [<span class="number">20</span>]: p</span><br><span class="line">Out[<span class="number">20</span>]: PosixPath(<span class="string">'/etc'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>路径拼接和分解</p>
</li>
<li>操作符/<ul>
<li>Path对象/Path对象</li>
<li>Path对象/字符串或者字符串/Path对象？</li>
</ul>
</li>
<li>分解：<ul>
<li>parts属性，可以返回路径中的每一个部分</li>
</ul>
</li>
<li><p>joinpath：</p>
<ul>
<li>joinpath(*other)连接多个字符串到Path对象中<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#举例</span></span><br><span class="line">In [<span class="number">21</span>]: p = Path()</span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: p = p / <span class="string">'a'</span><span class="comment">#当前路劲下的a</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: p</span><br><span class="line">Out[<span class="number">23</span>]: PosixPath(<span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">24</span>]: p1 = <span class="string">'b'</span> / p<span class="comment">#当前路径下的b下的a</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: p1</span><br><span class="line">Out[<span class="number">25</span>]: PosixPath(<span class="string">'b/a'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">26</span>]: p2 = Path(<span class="string">'c'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">27</span>]: p3 = p2 / p1</span><br><span class="line"></span><br><span class="line">In [<span class="number">28</span>]: print(p3.parts)<span class="comment">#返回路径中的每一个部分</span></span><br><span class="line">(<span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">29</span>]: p3</span><br><span class="line">Out[<span class="number">29</span>]: PosixPath(<span class="string">'c/b/a'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">30</span>]: p3.joinpath(<span class="string">'etc'</span>,<span class="string">'init.d'</span>,Path(<span class="string">'httpd'</span>))<span class="comment">#拼接路径</span></span><br><span class="line">Out[<span class="number">30</span>]: PosixPath(<span class="string">'c/b/a/etc/init.d/httpd'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>获取路径</p>
</li>
<li>str获取路径字符串</li>
<li>bytes获取路径字符串的bytes</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">31</span>]: p = Path(<span class="string">'/etc'</span>)</span><br><span class="line">In [<span class="number">32</span>]: print(str(p),bytes(p))</span><br><span class="line">/etc <span class="string">b'/etc'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>父目录</li>
<li>parent目录的逻辑父目录</li>
<li>parents父目录序列，索引0是直接父目录</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">33</span>]: p = Path(<span class="string">'a/b/c/d'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">34</span>]: print(p.parent.parent)<span class="comment">#一个parent代表a/b/c</span></span><br><span class="line">a/b</span><br><span class="line"></span><br><span class="line">In [<span class="number">35</span>]: <span class="keyword">for</span> x <span class="keyword">in</span> p.parents:</span><br><span class="line">    ...:     print(x)</span><br><span class="line">    ...:     </span><br><span class="line">a/b/c</span><br><span class="line">a/b</span><br><span class="line">a</span><br><span class="line">.</span><br></pre></td></tr></table></figure>
<ul>
<li>name目录的最后一个部分</li>
<li>suffix目录中最后一个部分的扩展名</li>
<li>stem目录最后一个部分，没有后缀</li>
<li>suffixes返回多个扩展名列表</li>
<li>with_suffix(suffix)补充扩展名到路径尾部，返回新的路径，扩展名存在则无效</li>
<li><p>with_name(name)替换目录后最后一个部分并返回一个新的路径</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#举例：</span></span><br><span class="line">In [<span class="number">38</span>]: p = Path(<span class="string">'/magedu/mysqlinstall/mysql.tar.gz'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">39</span>]: print(p.name)</span><br><span class="line">mysql.tar.gz</span><br><span class="line"></span><br><span class="line">In [<span class="number">40</span>]: print(p.suffix)</span><br><span class="line">.gz</span><br><span class="line"></span><br><span class="line">In [<span class="number">41</span>]: print(p.suffixes)</span><br><span class="line">[<span class="string">'.tar'</span>, <span class="string">'.gz'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">42</span>]: print(p.stem)</span><br><span class="line">mysql.tar</span><br><span class="line"></span><br><span class="line">In [<span class="number">43</span>]: print(p.with_name(<span class="string">'mysql-5.tgz'</span>))<span class="comment">#替换目录最后一部分，返回新路径</span></span><br><span class="line">/magedu/mysqlinstall/mysql<span class="number">-5.</span>tgz</span><br><span class="line"></span><br><span class="line">In [<span class="number">44</span>]: print(p.with_suffix(<span class="string">'.txt'</span>))<span class="comment">#补充扩展名到路径尾部，如果相同则不操作，返回新路径</span></span><br><span class="line">/magedu/mysqlinstall/mysql.tar.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>cwd()返回当前工作目录</p>
</li>
<li><p>home()返回当前家目录</p>
</li>
<li><p>is_dir()是否是目录</p>
</li>
<li>is_file()是否是普通文件</li>
<li>is_symlink()是否是软连接</li>
<li>is_socket()是否是socket文件</li>
<li>is_block_device()是否是块设备</li>
<li>is_char_device()是否是字符设备</li>
<li><p>is_absolute()是否是绝对路径</p>
</li>
<li><p>resolve()返回一个新路径，这个新路径就是当前Path对象的绝对路径，如果软链接直接被解析</p>
</li>
<li>absolute()也可以获取绝对路径，但是推荐使用resolve()</li>
<li>exists()目录或文件是否存在</li>
<li>rmdir()删除空目录，没有提供判断目录为空的方法</li>
<li>touch(mode=0o666，exist_ok=Ture)创建一个文件</li>
<li>as_uri()将路径返回成URI，例如‘file:///etc/passwd’</li>
<li>mkdir(mode=0o777,parents=False,exist_ok=False)#parents是否创建父目录，True等同于mkdir -p;父目录不存在，则抛出FileNotFoundError。exist_ok在3.5加入，False时路径存在抛出FileExistsError；True时，FileExistsError被忽略</li>
<li>iterdir()迭代当前目录</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#判断目录或文件是否存在</span></span><br><span class="line">In [<span class="number">11</span>]: p /= <span class="string">"a/b/c/d"</span></span><br><span class="line">In [<span class="number">13</span>]: p</span><br><span class="line">Out[<span class="number">13</span>]: PosixPath(<span class="string">'a/b/c/d'</span>)</span><br><span class="line">In [<span class="number">14</span>]: p.exists()</span><br><span class="line">Out[<span class="number">14</span>]: <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建目录并判断，无法创建父目录。</span></span><br><span class="line">In [<span class="number">15</span>]: p.mkdir()</span><br><span class="line">In [<span class="number">16</span>]: p.exists()</span><br><span class="line">Out[<span class="number">16</span>]: <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建父目录及子目录，类似于mkdir -p</span></span><br><span class="line">In [<span class="number">19</span>]: p.mkdir(parents=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#exist_ok False时，路径存在抛出FileExistsErros，True错误被忽略</span></span><br><span class="line">In [<span class="number">20</span>]: p.mkdir(parents=<span class="keyword">True</span>,exist_ok=<span class="keyword">True</span>)</span><br><span class="line">In [<span class="number">21</span>]: p.mkdir(parents=<span class="keyword">True</span>,exist_ok=<span class="keyword">False</span>)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">FileExistsError                           Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-21</span><span class="number">-381</span>fb58ad25b&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 p.mkdir(parents=True,exist_ok=False)</span><br><span class="line">~/.pyenv/versions/<span class="number">3.5</span><span class="number">.3</span>/lib/python3<span class="number">.5</span>/pathlib.py <span class="keyword">in</span> mkdir(self, mode, parents, exist_ok)</span><br><span class="line">   <span class="number">1218</span>         <span class="keyword">else</span>:</span><br><span class="line">   <span class="number">1219</span>             <span class="keyword">try</span>:</span><br><span class="line">-&gt; 1220                 self._accessor.mkdir(self, mode)</span><br><span class="line">   <span class="number">1221</span>             <span class="keyword">except</span> FileExistsError:</span><br><span class="line">   <span class="number">1222</span>                 <span class="keyword">if</span> <span class="keyword">not</span> exist_ok <span class="keyword">or</span> <span class="keyword">not</span> self.is_dir():</span><br><span class="line">~/.pyenv/versions/<span class="number">3.5</span><span class="number">.3</span>/lib/python3<span class="number">.5</span>/pathlib.py <span class="keyword">in</span> wrapped(pathobj, *args)</span><br><span class="line">    <span class="number">369</span>         @functools.wraps(strfunc)</span><br><span class="line">    <span class="number">370</span>         <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span><span class="params">(pathobj, *args)</span>:</span></span><br><span class="line">--&gt; 371             return strfunc(str(pathobj), *args)</span><br><span class="line">    <span class="number">372</span>         <span class="keyword">return</span> staticmethod(wrapped)</span><br><span class="line">    <span class="number">373</span> </span><br><span class="line">FileExistsError: [Errno <span class="number">17</span>] File exists: <span class="string">'a/b/c/d'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rmdir()删除空目录</span></span><br><span class="line">In [<span class="number">33</span>]: p3 = Path(<span class="string">'d'</span>)</span><br><span class="line">In [<span class="number">34</span>]: p3.mkdir()<span class="comment">#创建空目录</span></span><br><span class="line">In [<span class="number">35</span>]: p3.exists()<span class="comment">#存在性判断</span></span><br><span class="line">Out[<span class="number">35</span>]: <span class="keyword">True</span></span><br><span class="line">In [<span class="number">36</span>]: p3.rmdir()<span class="comment">#删除空目录</span></span><br><span class="line">In [<span class="number">37</span>]: p3.exists()</span><br><span class="line">Out[<span class="number">37</span>]: <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#迭代目录</span></span><br><span class="line">In [<span class="number">38</span>]: p</span><br><span class="line">Out[<span class="number">38</span>]: PosixPath(<span class="string">'a/b/c/d/readme.txt'</span>)</span><br><span class="line">In [<span class="number">39</span>]: <span class="keyword">for</span> x <span class="keyword">in</span> p.parents[len(p.parents)<span class="number">-1</span>].iterdir():<span class="comment">#中括号为索引</span></span><br><span class="line">    ...:     print(x,end=<span class="string">'\t'</span>)</span><br><span class="line">    ...:     <span class="keyword">if</span> x.is_dir():</span><br><span class="line">    ...:         flag = <span class="keyword">False</span></span><br><span class="line">    ...:         <span class="keyword">for</span> _ <span class="keyword">in</span> x.iterdir():</span><br><span class="line">    ...:             flag = <span class="keyword">True</span></span><br><span class="line">    ...:             <span class="keyword">break</span></span><br><span class="line">    ...:         print(<span class="string">'dir'</span>,<span class="string">'Not Empty'</span> <span class="keyword">if</span> flag <span class="keyword">else</span> <span class="string">'Empyt'</span>,sep=<span class="string">'\t'</span>)</span><br><span class="line">    ...:     <span class="keyword">elif</span> x.is_file():</span><br><span class="line">    ...:         print(<span class="string">'file'</span>)</span><br><span class="line">    ...:     <span class="keyword">else</span>:</span><br><span class="line">    ...:         print(<span class="string">'other file'</span>)</span><br></pre></td></tr></table></figure>
<p><strong>通配符</strong></p>
<ul>
<li>glob(pattern)通配符给定模式</li>
<li>rglob(pattern)通配符给定模式，递归目录<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">77</span>]: p</span><br><span class="line">Out[<span class="number">77</span>]: PosixPath(<span class="string">'.'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">78</span>]: list(p.glob(<span class="string">'*.py'</span>))<span class="comment">#只匹配当前路径</span></span><br><span class="line">[PosixPath(<span class="string">'test.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'sushu.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'lx2.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'lx.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'fang.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'123.py'</span>)]</span><br><span class="line"> In [<span class="number">80</span>]: list(p.rglob(<span class="string">'*.py'</span>))<span class="comment">#匹配下层所有目录</span></span><br><span class="line">[PosixPath(<span class="string">'test.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'sushu.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'lx2.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'lx.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'fang.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'123.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'a/a.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'a/b.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'a/b/b.py'</span>),</span><br><span class="line"> PosixPath(<span class="string">'a/b/c/c.py'</span>)]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>匹配</strong></p>
<ul>
<li>match(pattern)匹配模式，成功返回True</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">85</span>]: Path(<span class="string">'a/b.py'</span>).match(<span class="string">'*.py'</span>)</span><br><span class="line">Out[<span class="number">85</span>]: <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">86</span>]: Path(<span class="string">'a/b/c/c.py'</span>).match(<span class="string">'b/*.py'</span>)</span><br><span class="line">Out[<span class="number">86</span>]: <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">87</span>]: Path(<span class="string">'a/b/c/c.py'</span>).match(<span class="string">'a/b/c/*.py'</span>)</span><br><span class="line">Out[<span class="number">87</span>]: <span class="keyword">True</span></span><br></pre></td></tr></table></figure>
<p><strong>文件操作</strong></p>
<ul>
<li>open(mode=’r’,buffering=-1,encoding=None,errors=None,newline=None)<ul>
<li>使用方法类似于内建函数open。返回一个文件对象</li>
</ul>
</li>
<li>3.5增加新函数：</li>
<li>read_bytes():以rb读取路径对应文件，并返回二进制流，看源码</li>
<li>read_text(encoding=None,errors=None):以rt方式读取路径对应文件，返回文本</li>
<li>Path.write_bytes(data):以wb方式写入数据到路径对应文件</li>
<li>write_text(date,encoding=None,errors=None):以wt方式写入字符串到路径对应文件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">88</span>]: p = Path(<span class="string">'my_binary_file'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">89</span>]: p</span><br><span class="line">Out[<span class="number">89</span>]: PosixPath(<span class="string">'my_binary_file'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">90</span>]: p.write_bytes(<span class="string">b'abc'</span>)</span><br><span class="line">Out[<span class="number">90</span>]: <span class="number">3</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">91</span>]: p.read_bytes()</span><br><span class="line">Out[<span class="number">91</span>]: <span class="string">b'abc'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">92</span>]: p = Path(<span class="string">'my_text_file'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">93</span>]: p.write_text(<span class="string">'Text file contents'</span>)</span><br><span class="line">Out[<span class="number">93</span>]: <span class="number">18</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">94</span>]: p.read_text()</span><br><span class="line">Out[<span class="number">94</span>]: <span class="string">'Text file contents'</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/06/PY-PathOperations/" data-id="cjlpv8iur0005bsvxf4f9nsxw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python路径操作/">Python路径操作</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-PY-Module" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/06/PY-Module/" class="article-date">
  <time datetime="2018-08-05T16:00:00.000Z" itemprop="datePublished">2018-08-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/06/PY-Module/">PY-Module</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h1><ul>
<li>一般来说，编程语言中，库，包，模块是同一种概念，是代码组织方式</li>
<li>包package，指的是模块组织在一起的和包名同名的目录及其相关文件</li>
<li>模块：凡是.py文件都可以称作一个模块</li>
</ul>
<h5 id="导入语句"><a href="#导入语句" class="headerlink" title="导入语句"></a>导入语句</h5><ul>
<li>import 模块1[,模块2] ：完全导入</li>
<li>import … as…:模块别名</li>
<li>找到指定模块，加载和初始化它，生成模块对象，找不到，抛出ImportError异常</li>
<li><p>在import所在的作用域的局部命名空间中，增加名称和上一步创建的对象关联</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> functools<span class="comment">#导入模块</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: print(dir())</span><br><span class="line">[<span class="string">'In'</span>, <span class="string">'Out'</span>, <span class="string">'_'</span>, <span class="string">'__'</span>, <span class="string">'___'</span>, <span class="string">'__builtin__'</span>, <span class="string">'__builtins__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__loader__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__spec__'</span>, <span class="string">'_dh'</span>, <span class="string">'_i'</span>, <span class="string">'_i1'</span>, <span class="string">'_i2'</span>, <span class="string">'_i3'</span>, <span class="string">'_ih'</span>, <span class="string">'_ii'</span>, <span class="string">'_iii'</span>, <span class="string">'_oh'</span>, <span class="string">'exit'</span>, <span class="string">'functools'</span>, <span class="string">'get_ipython'</span>, <span class="string">'quit'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: print(functools)</span><br><span class="line">&lt;module <span class="string">'functools'</span> <span class="keyword">from</span> <span class="string">'c:\\users\\devops\\appdata\\local\\programs\\python\\python35\\lib\\functools.py'</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: print(functools.wraps)</span><br><span class="line">&lt;function wraps at <span class="number">0x000000C794C18A60</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: <span class="keyword">import</span> os.path<span class="comment">#导入os.path,os加入当前名词空间</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: print(dir())</span><br><span class="line">[<span class="string">'In'</span>, <span class="string">'Out'</span>, <span class="string">'_'</span>, <span class="string">'__'</span>, <span class="string">'___'</span>, <span class="string">'__builtin__'</span>, <span class="string">'__builtins__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__loader__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__spec__'</span>, <span class="string">'_dh'</span>, <span class="string">'_i'</span>, <span class="string">'_i1'</span>, <span class="string">'_i2'</span>, <span class="string">'_i3'</span>, <span class="string">'_i4'</span>, <span class="string">'_i5'</span>, <span class="string">'_i6'</span>, <span class="string">'_i7'</span>, <span class="string">'_ih'</span>, <span class="string">'_ii'</span>, <span class="string">'_iii'</span>, <span class="string">'_oh'</span>, <span class="string">'exit'</span>, <span class="string">'functools'</span>, <span class="string">'get_ipython'</span>, <span class="string">'os'</span>, <span class="string">'quit'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: print(os)</span><br><span class="line">&lt;module <span class="string">'os'</span> <span class="keyword">from</span> <span class="string">'c:\\users\\devops\\appdata\\local\\programs\\python\\python35\\lib\\os.py'</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: print(os.path)<span class="comment">#完全限定名称访问path</span></span><br><span class="line">&lt;module <span class="string">'ntpath'</span> <span class="keyword">from</span> <span class="string">'c:\\users\\devops\\appdata\\local\\programs\\python\\python35\\lib\\ntpath.py'</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: <span class="keyword">import</span> os.path <span class="keyword">as</span> osp</span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: print(dir())</span><br><span class="line">[<span class="string">'In'</span>, <span class="string">'Out'</span>, <span class="string">'_'</span>, <span class="string">'__'</span>, <span class="string">'___'</span>, <span class="string">'__builtin__'</span>, <span class="string">'__builtins__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__loader__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__spec__'</span>, <span class="string">'_dh'</span>, <span class="string">'_i'</span>, <span class="string">'_i1'</span>, <span class="string">'_i10'</span>, <span class="string">'_i11'</span>, <span class="string">'_i2'</span>, <span class="string">'_i3'</span>, <span class="string">'_i4'</span>, <span class="string">'_i5'</span>, <span class="string">'_i6'</span>, <span class="string">'_i7'</span>, <span class="string">'_i8'</span>, <span class="string">'_i9'</span>, <span class="string">'_ih'</span>, <span class="string">'_ii'</span>, <span class="string">'_iii'</span>, <span class="string">'_oh'</span>, <span class="string">'exit'</span>, <span class="string">'functools'</span>, <span class="string">'get_ipython'</span>, <span class="string">'os'</span>, <span class="string">'osp'</span>, <span class="string">'quit'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: print(osp)</span><br><span class="line">&lt;module <span class="string">'ntpath'</span> <span class="keyword">from</span> <span class="string">'c:\\users\\devops\\appdata\\local\\programs\\python\\python35\\lib\\ntpath.py'</span>&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>总结：</p>
<ul>
<li>导入顶级模块，其名称会加入到本地名词空间中，并绑定到其模块对象</li>
<li>导入非顶级模块，将其顶级模块加入到本地名词空间中。导入的模块必须使用完全限定名来访问</li>
<li>如果使用了as，其后的名称直接加入到本地名词空间中，并直接绑定到导入的模块对象</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th><strong>语句</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>from…import…</td>
<td>部分导入</td>
</tr>
<tr>
<td>from…import…as…</td>
<td>别名</td>
</tr>
</tbody>
</table>
<ul>
<li><p>from语句</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">13</span>]: <span class="keyword">from</span> pathlib <span class="keyword">import</span> Path,PosixPath<span class="comment">#在当前名词导入该模块的指定成员</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: print(dir())</span><br><span class="line">[.....<span class="string">'Path'</span>, <span class="string">'PosixPath'</span> ]</span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: <span class="keyword">from</span> pathlib <span class="keyword">import</span> *<span class="comment">#在当前名词空间导入该模块所有公共成员</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: print(dir())</span><br><span class="line">[..... <span class="string">'Path'</span>, <span class="string">'PosixPath'</span>, <span class="string">'PurePath'</span>, <span class="string">'PurePosixPath'</span>, <span class="string">'PureWindowsPath'</span>, <span class="string">'WindowsPath'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: <span class="keyword">from</span> functools <span class="keyword">import</span> wraps <span class="keyword">as</span> wr<span class="comment">#别名</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: print(dir())</span><br><span class="line">[......<span class="string">'wr'</span>]</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">In [<span class="number">19</span>]: <span class="keyword">from</span> os.path <span class="keyword">import</span> exists<span class="comment">#加载、初始化os.path模块，exists加入本地名词空间并绑定</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">20</span>]: <span class="keyword">if</span> exists(<span class="string">'f:/t'</span>):</span><br><span class="line">    ...:     print(<span class="string">'Found'</span>)</span><br><span class="line">    ...: <span class="keyword">else</span>:</span><br><span class="line">    ...:     print(<span class="string">'Not Found'</span>)</span><br><span class="line">Not Found</span><br><span class="line"></span><br><span class="line">In [<span class="number">21</span>]: print(dir())</span><br><span class="line">[<span class="string">'In'</span>, <span class="string">'Out'</span>, <span class="string">'Path'</span>, <span class="string">'PosixPath'</span>, <span class="string">'PurePath'</span>, <span class="string">'PurePosixPath'</span>, <span class="string">'PureWindowsPath'</span>, <span class="string">'WindowsPath'</span>, <span class="string">'_'</span>, <span class="string">'__'</span>, <span class="string">'___'</span>, <span class="string">'__builtin__'</span>, <span class="string">'__builtins__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__loader__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__spec__'</span>, <span class="string">'_dh'</span>, <span class="string">'_i'</span>, <span class="string">'_i1'</span>, <span class="string">'_i10'</span>, <span class="string">'_i11'</span>, <span class="string">'_i12'</span>, <span class="string">'_i13'</span>, <span class="string">'_i14'</span>, <span class="string">'_i15'</span>, <span class="string">'_i16'</span>, <span class="string">'_i17'</span>, <span class="string">'_i18'</span>, <span class="string">'_i19'</span>, <span class="string">'_i2'</span>, <span class="string">'_i20'</span>, <span class="string">'_i21'</span>, <span class="string">'_i3'</span>, <span class="string">'_i4'</span>, <span class="string">'_i5'</span>, <span class="string">'_i6'</span>, <span class="string">'_i7'</span>, <span class="string">'_i8'</span>, <span class="string">'_i9'</span>, <span class="string">'_ih'</span>, <span class="string">'_ii'</span>, <span class="string">'_iii'</span>, <span class="string">'_oh'</span>, <span class="string">'exists'</span>, <span class="string">'exit'</span>, <span class="string">'functools'</span>, <span class="string">'get_ipython'</span>, <span class="string">'os'</span>, <span class="string">'osp'</span>, <span class="string">'quit'</span>, <span class="string">'wr'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: print(exists)</span><br><span class="line">&lt;function exists at <span class="number">0x000000C79460F1E0</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">In [<span class="number">24</span>]: print(os.path.exists)</span><br><span class="line">&lt;function exists at <span class="number">0x000000C79460F1E0</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: print(os.path.__dict__[<span class="string">'exists'</span>])</span><br><span class="line">&lt;function exists at <span class="number">0x000000C79460F1E0</span>&gt;</span><br><span class="line"><span class="comment">#上面三种方式获得同一个对象</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>总结：</p>
</li>
<li>找到from子句中指定的模块，加载并初始化它（注意不是导入）</li>
<li>对于import子句后的名称<ul>
<li>先查from子句导入的模块是否具有该名称的属性</li>
<li>如果不是，则尝试导入该名称的子模块</li>
<li>还没有找到，则抛出ImportError异常</li>
<li>这个名称保存到本地名词空间中，如果有as子句，则使用as子句的名称</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">29</span>]: <span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line">In [<span class="number">30</span>]: print(Path,id(Path))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">pathlib</span>.<span class="title">Path</span>'&gt; 857194384056</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">In</span> [31]:</span> <span class="keyword">import</span> pathlib <span class="keyword">as</span> p1</span><br><span class="line"></span><br><span class="line">In [<span class="number">32</span>]: print(dir())</span><br><span class="line">[ ....<span class="string">'p1'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">33</span>]: print(p1)</span><br><span class="line">&lt;module <span class="string">'pathlib'</span> <span class="keyword">from</span> <span class="string">'c:\\users\\devops\\appdata\\local\\programs\\python\\python35\\lib\\pathlib.py'</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">34</span>]: print(p1.Path,id(p1.Path))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">pathlib</span>.<span class="title">Path</span>'&gt; 857194384056</span></span><br><span class="line"><span class="class">#可以看出导入的名词<span class="title">Path</span>和<span class="title">p1</span>.<span class="title">Path</span>是同一个对象</span></span><br></pre></td></tr></table></figure>
<h5 id="自定义模块"><a href="#自定义模块" class="headerlink" title="自定义模块"></a>自定义模块</h5><ul>
<li>自定义模块：.py文件就是模块</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test1.py</span></span><br><span class="line">print(<span class="string">'This is test1 module'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">showmodule</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"&#123;&#125;.a=&#123;&#125;"</span>.format(self.__module__,self))</span><br><span class="line">        print(self.__class__.__name__)</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">a.showmodule()</span><br><span class="line"></span><br><span class="line"><span class="comment">#test2.py</span></span><br><span class="line"><span class="keyword">import</span> test1</span><br><span class="line"></span><br><span class="line">print(<span class="string">'!'</span>*<span class="number">30</span>)</span><br><span class="line">a = test1.A()</span><br><span class="line">a.showmodule()</span><br><span class="line"></span><br><span class="line"><span class="comment">#test3.py</span></span><br><span class="line"><span class="keyword">from</span> test1 <span class="keyword">import</span> A <span class="keyword">as</span> cls</span><br><span class="line"></span><br><span class="line">a = cls()</span><br><span class="line">a.showmodule()</span><br><span class="line">----------------------------</span><br><span class="line"><span class="comment">#test2和test3打印结果一样</span></span><br><span class="line">This <span class="keyword">is</span> test1 module</span><br><span class="line">test1.a=&lt;test1.A object at <span class="number">0x000000FE9A1C8978</span>&gt;</span><br><span class="line">A</span><br><span class="line">test1.a=&lt;test1.A object at <span class="number">0x000000FE9A1C0438</span>&gt;</span><br><span class="line">A</span><br></pre></td></tr></table></figure>
<p><strong>自定义模块命名规范</strong></p>
<ul>
<li>模块名就是文件名</li>
<li>模块名必须符合标识符的要求，非数字开头的字母数字和下划线的组合。test-module.py这样的文件名不能作为模块名</li>
<li>不要使用系统模块名来避免冲突，除非你明确知道这个模块的用途</li>
<li>通常模块名为全小写，下划线来分割</li>
</ul>
<h5 id="模块搜索顺序"><a href="#模块搜索顺序" class="headerlink" title="模块搜索顺序"></a>模块搜索顺序</h5><ul>
<li><p>使用sys.path查看搜索顺序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> sys.path:</span><br><span class="line">    print(p)</span><br><span class="line">-----------------------</span><br><span class="line">F:\pycharm_product\python\<span class="number">1207</span></span><br><span class="line">F:\pycharm_product\python</span><br><span class="line">C:\Users\devops\AppData\Local\Programs\Python\Python35\python35.zip</span><br><span class="line">C:\Users\devops\AppData\Local\Programs\Python\Python35\DLLs</span><br><span class="line">C:\Users\devops\AppData\Local\Programs\Python\Python35\lib</span><br><span class="line">C:\Users\devops\AppData\Local\Programs\Python\Python35</span><br><span class="line">C:\Users\devops\AppData\Local\Programs\Python\Python35\lib\site-packages</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示结果为，python模块的路径搜索顺序</p>
</li>
<li>当加载一个模块的时候，需要从这些搜索路径中从前到后依次查找，不搜索这些目录的子目录，搜索到就加载，搜索不到就抛异常</li>
<li>路径可以是字典，zip文件，egg文件(.egg文件，由setuptools创建的包，第三方库常用格式。添加了元素(版本号、依赖项等信息的zip文件))</li>
<li>路径顺序为：<ul>
<li>程序主目录，程序运行的主程序脚本所在的目录</li>
<li>pythonpath目录，环境变量pythonpath设置的目录也是搜索模块的路径</li>
<li>标准库目录，python自带库模块所在目录</li>
<li>sys.path可以被修改，追加新的目录</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/06/PY-Module/" data-id="cjlpv8iur0002bsvx53ecr4eg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python模块化/">Python模块化</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-PY-Generator" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/23/PY-Generator/" class="article-date">
  <time datetime="2018-07-22T16:00:00.000Z" itemprop="datePublished">2018-07-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/23/PY-Generator/">Python-生成器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="生成器表达式Generator-expression"><a href="#生成器表达式Generator-expression" class="headerlink" title="生成器表达式Generator expression"></a>生成器表达式Generator expression</h2><ul>
<li>语法：<ul>
<li>(返回值 for 元素 in 可迭代对象 if 条件)</li>
<li>列表解析式的中括号换成小括号就行了</li>
<li>返回一个生成器</li>
</ul>
</li>
<li>和列表解析式的区别<ul>
<li>生成器表达式是<code>按需计算(或称惰性求值、延迟计算)</code>,需要的时候才计算值</li>
<li>列表解析式是<code>立即返回值</code></li>
</ul>
</li>
<li>生成器<ul>
<li>可迭代对象</li>
<li>迭代器</li>
</ul>
</li>
<li>举例：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">g = (<span class="string">"&#123;:04&#125;"</span>.format(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">11</span>))</span><br><span class="line">next(g)<span class="comment">#将第一个值取走</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> g:</span><br><span class="line">    print(x)</span><br><span class="line">print(<span class="string">"~"</span>*<span class="number">40</span>)<span class="comment">#上面已经将值取完所以没有可以获取的值</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> g:</span><br><span class="line">    print(x)</span><br><span class="line">--------------------------------</span><br><span class="line"><span class="number">0002</span></span><br><span class="line"><span class="number">0003</span></span><br><span class="line"><span class="number">0004</span></span><br><span class="line"><span class="number">0005</span></span><br><span class="line"><span class="number">0006</span></span><br><span class="line"><span class="number">0007</span></span><br><span class="line"><span class="number">0008</span></span><br><span class="line"><span class="number">0009</span></span><br><span class="line"><span class="number">0010</span></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong> 总结：延迟计算，返回迭代器，可以迭代，从前到后走完一遍，不能回头 </strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">g = [<span class="string">"&#123;:04&#125;"</span>.format(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">11</span>)]</span><br><span class="line"><span class="comment">#next(g)</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> g:</span><br><span class="line">    print(x)</span><br><span class="line">print(<span class="string">"~"</span>*<span class="number">40</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> g:</span><br><span class="line">    print(x)</span><br><span class="line"><span class="comment">#结果打印两遍0001-0010</span></span><br></pre></td></tr></table></figure>
<p><strong> 总结：立即计算，返回的不是迭代器，返回可迭代的对象列表，可以从头迭代 </strong></p>
<p><strong>生成器表达式</strong></p>
<ul>
<li>和列表表达式的对比<ul>
<li>计算方式<ul>
<li>生成器表达式延时计算，列表解析式立即计算</li>
</ul>
</li>
<li>内存占用<ul>
<li>单从返回值本身来说，生成器表达式省内存，列表解析式返回新的列表</li>
<li>生成器没有数据，内存占用极少，但是使用的时候，虽然一个一个返回数据，但是结合起来占用内存也差不多</li>
<li>列表解析式构造新的列表需要占用内存</li>
</ul>
</li>
<li>计算速度：<ul>
<li>单从计算时间来看，生成器表达式耗时非常短，列表解析式耗时长</li>
<li>但是生成器本身并没有返回任何值，只返回了一个生成器对象</li>
<li>列表解析式构造并返回了一个新列表</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/23/PY-Generator/" data-id="cjlpv8iur0003bsvxcrum2rmi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Generator/">Generator</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pyenv_virtualenv" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/15/pyenv_virtualenv/" class="article-date">
  <time datetime="2018-07-14T16:00:00.000Z" itemprop="datePublished">2018-07-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/15/pyenv_virtualenv/">pyenv virtualenv</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="pyenv多版本管理"><a href="#pyenv多版本管理" class="headerlink" title="pyenv多版本管理"></a>pyenv多版本管理</h2><h4 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h4><ul>
<li>系统自带的Python是2.x，自己需要Python 3.x,此时需要在系统中安装多个Python，但又不能影响系统自带的Python,即需要实现Python的多版本共存,pyenv就是这样一个Python版本管理器。</li>
</ul>
<h4 id="安装使用"><a href="#安装使用" class="headerlink" title="安装使用"></a>安装使用</h4><ol>
<li>yum install -y git gcc make patch gdbm-devel openssl-devel sqlite-devel readline-devel zlib-devel bzip2-devel</li>
<li>curl -L <a href="https://raw.githubusercontent.com/pyenv/pyenv-installer/master/bin/pyenv-installer" target="_blank" rel="noopener">https://raw.githubusercontent.com/pyenv/pyenv-installer/master/bin/pyenv-installer</a> |bash #下载安装pyenv</li>
<li><p>vi ~/.bash_profile #文件结尾添加</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PATH="/home/python/.pyenv/bin:$PATH"</span><br><span class="line">eval "$(pyenv init -)"</span><br><span class="line">eval "$(pyenv virtualenv-init -)"</span><br></pre></td></tr></table></figure>
</li>
<li><p>source ~/.bash_profile #立即生效</p>
</li>
<li>pyenv install –list #查看可安装包列表</li>
<li>pyenv install 3.5.5 #安装3.5.5版本python。因为网络问题安装可能很慢，可以先将包从官网下载下来然后将源文件放在~/.pyenv/cache目录下，如果没有则新建。执行pyenv install 3.5.5 -v这样就走缓存进行安装了。</li>
<li><p>pyenv versions #查看当前系统中有哪些py版本以及正在使用哪个</p>
</li>
<li><p>设置python版本：</p>
<ul>
<li><p>pyenv global 3.5.5     </p>
<ul>
<li>设置全局python环境版本，切不要在root用户下执行。否则整个需要pyhton执行程序都会被影响</li>
</ul>
</li>
<li><p>pyenv local 3.5.5</p>
<ul>
<li>设置从当前工作目录开始向下递归都继承这个设置</li>
</ul>
</li>
<li><p>pyenv shell 3.5.5</p>
<ul>
<li>只作用于当前会话</li>
</ul>
</li>
</ul>
</li>
<li><p>使用virtualenv创建出一个3.5.5版本独立的虚拟包环境，此环境下用pip安装的包不会</p>
<ul>
<li>pyenv virtualenv project_355 #使用Virtualenv插件创建版本的命名</li>
<li>pyenv versions #即可查看刚创建的命名</li>
<li>mkdir ~/doraemon/project355 #创建项目目录</li>
<li>cd ~/doraemon/project355 #进入项目目录</li>
<li>pyenv local projext_355 #这样整个项目都会应用py 3.5.5版本,跳出此目录则应用系统默认的py</li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/15/pyenv_virtualenv/" data-id="cjlpv8iv6000dbsvx8vlj7h3n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python-pyenv/">python-pyenv</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-inner_to_outer_openvpn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/09/inner_to_outer_openvpn/" class="article-date">
  <time datetime="2018-07-08T16:00:00.000Z" itemprop="datePublished">2018-07-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/09/inner_to_outer_openvpn/">openvpn</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="企业内网到阿里云内网互通解决方案"><a href="#企业内网到阿里云内网互通解决方案" class="headerlink" title="企业内网到阿里云内网互通解决方案"></a>企业内网到阿里云内网互通解决方案</h2><h4 id="网络拓扑"><a href="#网络拓扑" class="headerlink" title="网络拓扑"></a>网络拓扑</h4><p><img src="/images/network.png" alt="image"></p>
<h4 id="Server端搭建（云服务器Centos7-4）"><a href="#Server端搭建（云服务器Centos7-4）" class="headerlink" title="Server端搭建（云服务器Centos7.4）"></a>Server端搭建（云服务器Centos7.4）</h4><ul>
<li><p>openvpn install</p>
<ul>
<li>yum -y install epel-release</li>
<li>yum -y install openvpn</li>
<li>yum -y install unzip</li>
</ul>
</li>
<li><p>Easy RSA3生成密钥及证书</p>
<ul>
<li>wget -c <a href="https://github.com/OpenVPN/easy-rsa/archive/master.zip" target="_blank" rel="noopener">https://github.com/OpenVPN/easy-rsa/archive/master.zip</a></li>
<li>unzip master.zip</li>
<li>mv easy-rsa-master easy-rsa</li>
<li>cp easy-rsa /etc/openvpn/  -r</li>
<li><p>cd /etc/openvpn/easy-rsa/easyrsa3</p>
</li>
<li><p>生成服务器端证书</p>
</li>
<li>cp vars.example vars</li>
<li>./easyrsa init-pki #建立空的pki结构，生成文件和目录</li>
<li>./easyrsa build-ca #创建ca，密码和cn需要记住将来跟客户端签约时需要认证fangtang2018 doraemon</li>
<li>./easyrsa gen-req server nopass #创建服务端证书cn最好不要跟前面的一样deploy</li>
<li>./easyrsa sign server server #签约服务端证书</li>
<li><p>./easyrsa gen-dh #创建Diffie-Hellman</p>
</li>
<li><p>生成客户端证书</p>
</li>
<li>mkdir /home/client &amp;&amp; cd /home/client #创建临时工作目录</li>
<li>cp -R ~/easy-rsa/ ./ #此处时刚解压的文件</li>
<li>cd easy-rsa/easyrsa3/</li>
<li>cp vars.example vars</li>
<li>./easyrsa init-pki</li>
<li><p>./easyrsa gen-req username #生成用户的证书，输入密码为登陆认证时的密码fangtangdeploy</p>
</li>
<li><p>客户签约（签约后才可以使用vpn）</p>
</li>
<li>cd /etc/openvpn/easy-rsa/easyrsa3/</li>
<li>./easyrsa import-req /home/client/easy-rsa/easyrsa3/pki/reqs/username.req username #导入req</li>
<li><p>./easyrsa sign client username #用户签约，根据提示输入服务端ca密码</p>
</li>
<li><p>整理服务端证书</p>
</li>
<li>mkdir /etc/openvpn/keys</li>
<li>cp /etc/openvpn/easy-rsa/easyrsa3/pki/ca.crt /etc/openvpn/keys</li>
<li>cp /etc/openvpn/easy-rsa/easyrsa3/pki/private/server.key /etc/openvpn/keys</li>
<li>cp /etc/openvpn/easy-rsa/easyrsa3/pki/issued/server.crt /etc/openvpn/keys</li>
<li><p>cp /etc/openvpn/easy-rsa/easyrsa3/pki/dh.pem /etc/openvpn/keys</p>
</li>
<li><p>整理客户端证书</p>
</li>
<li>mkdir /home/myclient</li>
<li>cp /etc/openvpn/easy-rsa/easyrsa3/pki/ca.crt /home/myclient/</li>
<li>cp /etc/openvpn/easy-rsa/easyrsa3/pki/issued/username.crt /home/myclient/</li>
<li>cp /home/client/easy-rsa/easyrsa3/pki/private/username.key /home/myclient/</li>
<li>cp /usr/share/doc/openvpn-2.4.4/sample/sample-config-files/client.conf /home/myclient/</li>
<li>mv client.conf client.ovpn</li>
</ul>
</li>
<li><p>配置文件修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">local</span> Outer_IP</span><br><span class="line">port 1194</span><br><span class="line">;proto tcp</span><br><span class="line">proto udp</span><br><span class="line">;dev tap</span><br><span class="line">dev tun</span><br><span class="line">;dev-node MyTap</span><br><span class="line">ca /etc/openvpn/keys/ca.crt</span><br><span class="line">cert /etc/openvpn/keys/server.crt</span><br><span class="line">key /etc/openvpn/keys/server.key  <span class="comment"># This file should be kept secret</span></span><br><span class="line">dh /etc/openvpn/keys/dh.pem</span><br><span class="line">;topology subnet</span><br><span class="line">server 10.8.0.0 255.255.255.0</span><br><span class="line">ifconfig-pool-persist ipp.txt</span><br><span class="line">;server-bridge 10.8.0.4 255.255.255.0 10.8.0.50 10.8.0.100</span><br><span class="line">;server-bridge</span><br><span class="line">;push <span class="string">" 192.168.10.0 255.255.255.0"</span> <span class="comment">#向客户端推送的路由信息，假如客户端的IP地址为10.8.0.2，要访问192.168.10.0网段的话，使用这条命令就可以了。</span></span><br><span class="line">;push <span class="string">" 192.168.20.0 255.255.255.0"</span></span><br><span class="line">;client-config-dir ccd</span><br><span class="line">; 192.168.40.128 255.255.255.248</span><br><span class="line">;client-config-dir ccd</span><br><span class="line">; 10.9.0.0 255.255.255.252</span><br><span class="line">;learn-address ./script</span><br><span class="line">;push <span class="string">"dhcp-option DNS 208.67.222.222"</span> <span class="comment">#向客户端推送的DNS信息</span></span><br><span class="line">;push <span class="string">"dhcp-option DNS 208.67.220.220"</span></span><br><span class="line">;client-to-client <span class="comment">#这条命令可以使客户端之间能相互访问，默认设置下客户端间是不能相互访问的。</span></span><br><span class="line">;duplicate-cn</span><br><span class="line">keepalive 10 120 <span class="comment">#定义活动连接保时期限</span></span><br><span class="line">cipher AES-256-CBC</span><br><span class="line">;compress lz4-v2</span><br><span class="line">;push <span class="string">"compress lz4-v2"</span></span><br><span class="line">comp-lzo <span class="comment">#启用允许数据压缩，客户端配置文件也需要有这项。</span></span><br><span class="line">max-clients 100 <span class="comment">#定义最大客户端并发连接数量</span></span><br><span class="line">;user nobody</span><br><span class="line">;group nobody</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">status openvpn-status.log <span class="comment">#把openvpn的一些状态信息写到文件中，比如客户端获得的IP地址。</span></span><br><span class="line">;<span class="built_in">log</span>         openvpn.log <span class="comment">#记录日志，每次重新启动openvpn后删除原有的log信息。也可以自定义log的位置。默认是在/etc/openvpn/目录下。</span></span><br><span class="line">;<span class="built_in">log</span>-append  openvpn.log <span class="comment">#记录日志，每次重新启动openvpn后追加原有的log信息。</span></span><br><span class="line">verb 3 <span class="comment">#设置日志记录冗长级别。</span></span><br><span class="line">;mute 20</span><br><span class="line">explicit-exit-notify 1</span><br><span class="line"><span class="comment">#* push “redirect-gateway def1 bypass-dhcp”[这条命令可以重定向客户端的网关，在进行翻墙时会使用到,注释掉]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设置开机启动服务:systemctl start <a href="mailto:openvpn@server.service" target="_blank" rel="noopener">openvpn@server.service</a></p>
</li>
<li>Linux系统配置<ul>
<li><ul>
<li>开启路由转发：</li>
</ul>
</li>
<li>echo “net.ipv4.ip_forward = 1” &gt;&gt; /etc/sysctl.conf</li>
<li>sysctl -p </li>
<li>防火墙设置：</li>
<li>yum install iptables-services iptables-devel</li>
<li>iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -j MASQUERADE -o eth0#此处填写网段必须时vpn</li>
</ul>
</li>
</ul>
<h4 id="Client端搭建（内网服务器Centos7-4）"><a href="#Client端搭建（内网服务器Centos7-4）" class="headerlink" title="Client端搭建（内网服务器Centos7.4）"></a>Client端搭建（内网服务器Centos7.4）</h4><ul>
<li>yum install -y openvpn</li>
<li><p>配置文件修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">client</span><br><span class="line">dev tun</span><br><span class="line">proto udp</span><br><span class="line">remote <span class="string">"Server_IP"</span> 1194</span><br><span class="line">resolv-retry infinite</span><br><span class="line">nobind</span><br><span class="line"></span><br><span class="line"><span class="comment"># Downgrade privileges after initialization (non-Windows only)</span></span><br><span class="line">;user nobody</span><br><span class="line">;group nobody</span><br><span class="line"></span><br><span class="line"><span class="comment"># Try to preserve some state across restarts.</span></span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line"></span><br><span class="line">ca ca.crt</span><br><span class="line">cert xxx.crt</span><br><span class="line">key xxx.key</span><br><span class="line">remote-cert-tls server</span><br><span class="line"></span><br><span class="line"><span class="comment"># If a tls-auth key is used on the server</span></span><br><span class="line"><span class="comment"># then every client must also have the key.</span></span><br><span class="line"><span class="comment">##tls-auth ta.key 1</span></span><br><span class="line">cipher AES-256-CBC</span><br><span class="line">comp-lzo</span><br><span class="line">verb 3</span><br></pre></td></tr></table></figure>
</li>
<li><p>openvpn –daemon –cd /etc/openvpn/ –config client.ovpn –log-append /var/log/openvpn.log –askpass</p>
</li>
<li><p>自动启动脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> timeout 30</span><br><span class="line">spawn openvpn --daemon --<span class="built_in">cd</span> /etc/openvpn/ --config client.ovpn --<span class="built_in">log</span>-append /var/<span class="built_in">log</span>/openvpn.log --askpass</span><br><span class="line">expect <span class="string">"Enter Private Key Password:"</span></span><br><span class="line">send <span class="string">"Yourpass\r"</span></span><br><span class="line">interact</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置iptables</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 192.168.2.0/24 -j MASQUERADE -o tun0</span><br><span class="line">iptables -t nat -A POSTROUTING -s 10.9.0.0/24 -j MASQUERADE -o em1</span><br><span class="line">iptables -A INPUT -s 10.9.0.0/24  -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 10.8.0.0/24  -j ACCEPT</span><br><span class="line">iptables -A INPUT  -p udp --dport 1194 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="路由器设置（H3C-ER3260G2）"><a href="#路由器设置（H3C-ER3260G2）" class="headerlink" title="路由器设置（H3C ER3260G2）"></a>路由器设置（H3C ER3260G2）</h4><ul>
<li>添加静态路由<ul>
<li>登录路由器后台–&gt;”高级设置”–&gt;”路由设置”–&gt;”静态路由”–&gt;”新增”</li>
<li>添加目的地址段为”10.9.0.0/16”,下一调为内部VPN内网地址的路由</li>
<li>添加目的地址段为”腾讯云内网网段”，下一跳为内部VPN内网地址的路由</li>
</ul>
</li>
<li>设置策略路由<ul>
<li>策略路由添加各个网段到腾讯云VPN DHCP：”10.8.0.0/16”<--->“内网vlan”</---></li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/09/inner_to_outer_openvpn/" data-id="cjlpv8iv6000absvxen9dh902" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VPN/">VPN</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Re03" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/24/Re03/" class="article-date">
  <time datetime="2018-06-23T16:00:00.000Z" itemprop="datePublished">2018-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/24/Re03/">regular expression 03</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h2><ul>
<li><p>回溯引用匹配(backreference)</p>
<ul>
<li>概念：模式的后半部分引用在前半部分中定义的子表达式</li>
<li><p>举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;This is a block of of text&quot;</span><br><span class="line">正则:[ ]+(\w+)[ ]+\1 可匹配到 of of </span><br><span class="line">注意：</span><br><span class="line">1.此处\1代表模式里的第一个子表达式，依次类推</span><br><span class="line">2.回溯引用只能用来引用模式里的子表达式</span><br><span class="line">3.回溯引用匹配通常从1开始计数，第0个匹配可以用来代表这个正则表达式</span><br></pre></td></tr></table></figure>
</li>
<li><p>回溯引用在替换中的应用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;Hello ben@forta.com is my email address&quot;</span><br><span class="line">正则:(\w+[\w\.]*@[\w\.]+\.\w+)</span><br><span class="line">替换:&lt;A HREF=&quot;mailto:$1&quot;&gt;$1&lt;/A&gt;</span><br><span class="line">这样就把邮箱变为了可以点击的邮箱地址</span><br></pre></td></tr></table></figure>
</li>
<li><p>替换操作需要用到两个正则表达式，一个用来搜索，一个用来匹配文件的替换模式。</p>
</li>
<li>回溯引用可以跨模式使用，在第一个模式里被匹配的子表达式可以在第二个模式里面使用</li>
</ul>
</li>
<li><p>前后查找(lookaround)</p>
<ul>
<li>概念：对某一位置的前、后内容进行查找</li>
<li><p>向前查找</p>
<ul>
<li>指定一个必须匹配但不在结果中返回的模式，(?=)开头的子表达式等号后跟匹配的文本<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;http://www.forta.com/&quot;</span><br><span class="line">正则:.+(?=:)==&gt;&quot;http&quot;</span><br><span class="line">这样就可以吧冒号之前的所有字符都匹配出来，但是不包括冒号</span><br><span class="line">正则2:.+(:)==&gt;&quot;http:&quot;</span><br><span class="line">这个正则查找到并匹配结果包含冒号</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>向后查找</p>
<ul>
<li>查找出现在匹配文本之前的字符，但不消费它。向后查找操作符是?&lt;=<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;ABC01 $23.45&quot;#匹配$后的数字</span><br><span class="line">正则:(?&lt;=\$)[0-9.]+</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>区分?=he ?&lt;=与其他?</p>
<ul>
<li>有小于号的是向后查找操作符，把这个小于号想成一个箭头，它指向文本阅读方向的后方 </li>
</ul>
</li>
<li>对前后查找取非<ul>
<li>负前后查找，将前后查找的等号换成叹号</li>
<li>(?=):正向前查找</li>
<li>(?!):负向前查找，将向前查找不与给定模式向匹配的文本</li>
<li>(?&lt;=):正向后查找</li>
<li>(?&lt;!):负向后查找，将向后查找不与给定模式向匹配的文本</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/24/Re03/" data-id="cjlpv8iv6000bbsvx9h9puxek" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/正则-回溯引用及前后查找/">正则-回溯引用及前后查找</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Re02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/19/Re02/" class="article-date">
  <time datetime="2018-06-18T16:00:00.000Z" itemprop="datePublished">2018-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/19/Re02/">regular expression 02</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="匹配"><a href="#匹配" class="headerlink" title="匹配"></a>匹配</h1><h2 id="重复匹配"><a href="#重复匹配" class="headerlink" title="重复匹配"></a>重复匹配</h2><h4 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h4><ul>
<li>匹配多个连续重复的字符或字符集合</li>
</ul>
<h4 id="内容："><a href="#内容：" class="headerlink" title="内容："></a>内容：</h4><ul>
<li>“@”字符不需要转义，但是”.”需要</li>
<li>“+”,匹配同一个字符或字符集合[一次或多次]。举例：a匹配a本身，a+匹配一个或多个连续的a，类似的[0-9]+将匹配一个或多个连续的数字</li>
<li>“[,+]”,当元字符出现在集合的时候，将被解释为普通字符</li>
<li>“*”,匹配同一个字符或字符集合[零次或多次]</li>
<li>“?”,匹配同一个字符或字符集合[零次或一次]</li>
<li>“{}”,匹配重复次数的精确值，这个字符本身也是元字符所以如需要匹配本身需要转义{n,m}n到m次，至少匹配n次{n,}</li>
<li>贪婪模式与懒惰模式：<ul>
<li>贪婪型元字符：<em> 对应懒惰型字符 </em>？</li>
<li>贪婪型元字符：+ 对应懒惰型字符 +？</li>
<li>贪婪型元字符：{n, } 对应懒惰型字符 {n, }?</li>
</ul>
</li>
</ul>
<p><code>注意：一个字符也可以定义为一个集合，好处是可以增加可读性和避免产生误解</code></p>
<h2 id="位置匹配"><a href="#位置匹配" class="headerlink" title="位置匹配"></a>位置匹配</h2><h4 id="作用：-1"><a href="#作用：-1" class="headerlink" title="作用："></a>作用：</h4><ul>
<li>需要对某段文本的特定位置进行匹配</li>
</ul>
<h4 id="内容：-1"><a href="#内容：-1" class="headerlink" title="内容："></a>内容：</h4><ul>
<li>\b:单词边界boundary，匹配一个单词的开始或结尾</li>
<li>\B:不匹配单词边界</li>
<li>^:定义字符串的开头，当该字符出现在集合的开头时表示“非”</li>
<li>$:定义字符串的结尾</li>
<li>(?m):分行匹配模式multiline mode，使用时必须出现在整个模式的最前面，把换行符作为字符串分割符。^$还将匹配在一个换行符处开头或结束的字符串。</li>
</ul>
<h2 id="子表达式"><a href="#子表达式" class="headerlink" title="子表达式"></a>子表达式</h2><h4 id="作用：-2"><a href="#作用：-2" class="headerlink" title="作用："></a>作用：</h4><ul>
<li>subexpression：把一个表达式划分为一系列子表达式的目的是为了<code>把子表达式当作一个独立的元素来使用</code>，子表达式必须用()括起来</li>
<li>对重复次数元字符的作用对象作出精确的设定和控制、对|操作符的OR条件作出准确的定义，允许嵌套使用。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/19/Re02/" data-id="cjlpv8iv60006bsvx0gpogfg6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/正则-匹配/">正则-匹配</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Re01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/15/Re01/" class="article-date">
  <time datetime="2018-06-14T16:00:00.000Z" itemprop="datePublished">2018-06-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/15/Re01/">regular expression</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h1><h3 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h3><ul>
<li>正则表达式是一些用来匹配和处理文本的字符串</li>
<li>正则表达式经常被简称为模式（pattern）</li>
</ul>
<h3 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h3><ul>
<li>正则用来完成搜索和替换操作</li>
</ul>
<h3 id="详细说明"><a href="#详细说明" class="headerlink" title="详细说明"></a>详细说明</h3><ul>
<li>正则可以包含纯文本（甚至只包含纯文本）</li>
<li>正则分类：一种是用来匹配文本的，另一种是正则表达式的语法要求的（比如[]）</li>
<li>“.”，可以匹配任何一个字符并不准确，应该说可以匹配除换行符外的任何单个字符</li>
<li>“[]”，字符集合：[A-Z]:匹配所有大写字母，[a-z]:小写，[A-z]:ASCII字符A到z的所有字母但是还包括[和^等包含在ASCII码表中的特殊字符</li>
<li>“^”,取非匹配:除了字符集合里的字符，其他都可以匹配。作用于给定字符集合里的所有字符或区间。</li>
<li><p>“\”转意符：在完整的正则表达式里面，字符\后面永远跟着另一个字符</p>
</li>
<li><p>类元字符：</p>
<ul>
<li>匹配空白字符的元字符：\r \n \t最常用</li>
<li>\d：任何一个数字字符</li>
<li>\D：任何一个非数字字符</li>
<li>\w：任何一个字母数字下划线的集合，等同于[a-zA-Z0-9_]</li>
<li>\W：取反\w</li>
<li>\s：任何一个空白字符</li>
<li>\S：取反\s</li>
<li>\x：16进制，\0：八进制</li>
<li>POSIX字符类:大部分的正则都支持的一种简写形式：<ul>
<li>[:alnum:]:任何一个字母或数字([a-zA-Z0-9])</li>
<li>[:alpha:]:任何一个字母([a-zA-Z])</li>
<li>[:blank:]:空格或制表符([\t ])</li>
<li>[:digit:]:任何一个数字([0-9])</li>
<li>….</li>
<li>提示：POSIX字符必须包括在[::]之间，外层的[]来定义一个字符组合([[:alpha:]]</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>注意：1.验证某个模式匹配即正则表达式，能不能获取预期的匹配结果并不困难，但是如何验证它不会匹配到你不想要的东西就没那么容易了 2.语法是正则表达式最容易掌握的部分，重点是把实际问题分解成一系列的正则并最终解决。</code></p>
<h3 id="匹配"><a href="#匹配" class="headerlink" title="匹配"></a>匹配</h3><ul>
<li>字符匹配:</li>
<li>位置匹配：</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/15/Re01/" data-id="cjlpv8iv60007bsvxbzkgif8o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/正则/">正则</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-CD02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/13/CD02/" class="article-date">
  <time datetime="2018-06-13T14:01:06.840Z" itemprop="datePublished">2018-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="持续交付"><a href="#持续交付" class="headerlink" title="持续交付"></a>持续交付</h1><h2 id="第二章："><a href="#第二章：" class="headerlink" title="第二章："></a>第二章：</h2><hr>
<h3 id="阅读重点："><a href="#阅读重点：" class="headerlink" title="阅读重点："></a>阅读重点：</h3><ul>
<li>配置管理：配置管理是一指一个过程，通过该过程，所有与项目相关的产物，以及它们之间的关系都被唯一定义、修改、存储和检索。</li>
<li>解决的问题：<ul>
<li>管理应用程序的构建、部署、测试和发布</li>
<li>管理应用软件配置信息</li>
<li>整个环境的配置管理，包括应用程序所依赖的软件、硬件和基础设置</li>
</ul>
</li>
</ul>
<ol>
<li>使用版本控制<ul>
<li>目的1：保留每个文件的所有版本的历史信息，并使之易于查找。[元数据：用于描述数据的存储信息]基于元数据的访问方式与某个文件相链接</li>
<li>目的2：让分布式团队可以方便的协作</li>
<li>目的3:某个特定的版本由哪些文件和配置组成，如何再现一份与生产环境一模一样的软硬件环境</li>
<li>目的4：什么时候修改了什么内容，是谁修改的，以及为什么要修改来定位软件何时出错，出错的过程，甚至出错的原因。</li>
<li>对哪些内容需要进行版本控制：之所以版本控制不叫源代码控制是因为，不仅仅需要对源代码进行管理，每个与所开发的软件相关的产物都应该被置于版本控制之下（从持续集成到一键部署都依赖这个前提，与项目相关的所有东西都在版本控制中）</li>
<li>我们的目标是能够随时获取软件在声明周期中任意时间点的文件状态，这样我们就可以选择从开发环境至生产环境整个环节中的任意时间点，并将系统恢复到该时间点 </li>
<li>并不推荐将编译后的二进制文件纳入版本控制中：首先通常会比较大，其次可以利用源代码重新生成需要的二进制文件，所以没必要。</li>
<li>使用版本控制时，首先要频繁的提交代码才能享受版本控制的好处，如回滚。其次一旦提交所有团队的人都能看到变更并迁出它。 </li>
<li>使用明显意义的注释，能够清楚当初为何修改这行代码的话就为调试节省了大量的时间，注释中应该包括一个链接，可以链接到项目管理工具中的一个功能或缺陷。</li>
</ul>
</li>
<li>依赖管理<ul>
<li>外部库文件:在构建系统中，应该始终指定项目所需的外部库的确切版本，否则很难保证每次能够完全再现你的构建版本。比如：花很长时间来追踪一个奇怪的问题或错误，最终发现可能是由库文件版本不符导致。</li>
<li>组件管理：将整个应用软件分成一系列的组件今次那个开发，会让某些变更的影响范围变小，从而减少回归缺陷。此外还有利于重用，使大项目开发更加高效</li>
</ul>
</li>
<li>软件配置管理<ul>
<li>配置信息与产品代码及数据共同组成了应用程序，软件在构建、部署和运行时，我们可以通过配置信息来改变它的行为。</li>
<li>要为用户提供的软件配置能力越强，你能置于系统配置的约束就应越少，而编程环境也会变得越复杂</li>
<li>平衡配置和程序之间比较好的方法是：先专注于提供更有价值且可配置程度较低的功能，然后真正需要时再添加可配置选项</li>
<li>应用程序的配置信息应当做代码一样看待，恰当的管理它，并对它进行测试。</li>
</ul>
</li>
<li>环境管理<ul>
<li>应用程序都依赖与硬件、软件、基础设施以及外部系统才能正常工作，我们把这些内容都称作应用程序的环境。环境的配置和应用程序的配置同样重要</li>
<li>环境管理的关键是通过一个全自动过程来创建环境，是创建全新的环境比修复已受损的旧环境容易的多。重现环境的能力也很重要</li>
<li>高效的配置管理策略基本原则：<ul>
<li>将二进制文件与配置文件分离</li>
<li>将所的配置信息保存在一处</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><blockquote>
<p>配置管理是持续集成、发布管理以及部署流水线的基础，对交付团队的内部协作也会起到巨大的促进作用。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/13/CD02/" data-id="cjlpv8iur0001bsvxfu1n9b0k" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CD01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/13/CD01/" class="article-date">
  <time datetime="2018-06-13T14:01:06.824Z" itemprop="datePublished">2018-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="持续交付"><a href="#持续交付" class="headerlink" title="持续交付"></a>持续交付</h1><h2 id="第一章："><a href="#第一章：" class="headerlink" title="第一章："></a>第一章：</h2><hr>
<h3 id="阅读重点："><a href="#阅读重点：" class="headerlink" title="阅读重点："></a>阅读重点：</h3><ul>
<li>针对软件交付的痛点，如何处理</li>
</ul>
<ol>
<li>手工操作整个发布过程：安装操作系统再将程序所依赖的第三方软件装好，手工将应用程序的软件产物复制到生产环境，创建配置信息到最后启动应用程序。如果整个架构是分布式或者面向服务的应用程序，在一部分一部分的完成风险极大，如果一步没有完美的执行，应用程序就无法正确的执行。而且很难一下子找到出错的位置。</li>
<li><p>反模式：手工部署软件。容易发生人为错误或者发布步骤的执行顺序和时机不同也会导致结果的差异</p>
<blockquote>
<p>部署应该走向完全自动化，减少重复、无聊以及人为的失误。从过度的工作中解放出来以投身于更高价值的工作。</p>
</blockquote>
</li>
<li><p>反模式：开发完成之后才向类生产环境部署。发布周期越长，开发团队在部署前作出错误假定的时间就越长，修复这些问题的时间也就越长。开发过程做的假设与现实之间的差距就越大。例如在windows系统上开发软件，最终要部署早solaris集群上。很多意想不到的事情。</p>
<blockquote>
<p>对策就是讲测试、部署和发布活动纳入到开发过程，让它们称为开发流正常的一部分</p>
</blockquote>
</li>
<li>反模式：生产环境的手工配置管理。登录到生产服务器上手动修改配置，将修改进行记录，部署失败经常是某个人在生产环境下打了补丁，但却没有记录这次修改。系统无法回滚到之前部署的某个配置，不知道从什么时候开始集群中所用的操作系统，第三发基础设施依赖库版本或补丁级别就不同了。<blockquote>
<p>自动化的关键：变更首先应该被提交到版本控制系统中，然后通过自动化过程对环境进行更新</p>
</blockquote>
</li>
</ol>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p><code>持续集成：</code>每次提交都对应用程序进行构建并测试</p>
<p><code>部署流水线</code>：<br>可以让开发、测试、运维更高效的协同工作，<br>让软件构建、部署、测试和发布过程对所有人可见，<br>改善反馈，以便在整个过程中更早的发现并解决问题，<br>团队能够通过一个完全自动化的过程在任意环境上部署发布软件的任意版本</p>
<blockquote>
<p>目标：<br>将软件发布工作变成一个低风险、频繁、廉价、迅速可预见没有任何突发事件且索然无味的事情。将高度自动化的测试和部署以及全面的配置管理结合在一起，实现一键式软件发布。因此以一种高效、快速、可靠的方式交付高质量且有价值的软件就是我们目标。</p>
</blockquote>
<blockquote>
<p>实现：短周期、高质量的发布软件就需要，自动化：可重复部署，统一软件本身系统配置及环境，以保证每次的结果都是相同的，减少手动操作的错误机会。频繁做：如果能够做到频繁发布，每个发布版本之间的差异很小，减少了发布的相关风险。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/13/CD01/" data-id="cjlpv8iub0000bsvxvccv6gan" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Generator/">Generator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python模块化/">Python模块化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python路径操作/">Python路径操作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VPN/">VPN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-pyenv/">python-pyenv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/正则/">正则</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/正则-匹配/">正则-匹配</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/正则-回溯引用及前后查找/">正则-回溯引用及前后查找</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Generator/" style="font-size: 10px;">Generator</a> <a href="/tags/Python模块化/" style="font-size: 10px;">Python模块化</a> <a href="/tags/Python路径操作/" style="font-size: 10px;">Python路径操作</a> <a href="/tags/VPN/" style="font-size: 10px;">VPN</a> <a href="/tags/python-pyenv/" style="font-size: 10px;">python-pyenv</a> <a href="/tags/正则/" style="font-size: 10px;">正则</a> <a href="/tags/正则-匹配/" style="font-size: 10px;">正则-匹配</a> <a href="/tags/正则-回溯引用及前后查找/" style="font-size: 10px;">正则-回溯引用及前后查找</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/09/06/PY-PathOperations/">PY-PathOperations</a>
          </li>
        
          <li>
            <a href="/2018/08/06/PY-Module/">PY-Module</a>
          </li>
        
          <li>
            <a href="/2018/07/23/PY-Generator/">Python-生成器</a>
          </li>
        
          <li>
            <a href="/2018/07/15/pyenv_virtualenv/">pyenv virtualenv</a>
          </li>
        
          <li>
            <a href="/2018/07/09/inner_to_outer_openvpn/">openvpn</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Thunk Lee<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>